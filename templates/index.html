<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transliteration Tools</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .upload-area {
        padding: 40px;
      }

      .file-input-wrapper {
        position: relative;
        margin-bottom: 30px;
      }

      .file-input {
        width: 100%;
        padding: 20px;
        border: 3px dashed #bdc3c7;
        border-radius: 10px;
        text-align: center;
        background: #f8f9fa;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-input:hover {
        border-color: #3498db;
        background: #e8f4fc;
      }

      .file-input.dragover {
        border-color: #2ecc71;
        background: #e8f6f3;
      }

      .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .option-group {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
      }

      .option-group h3 {
        margin-bottom: 15px;
        color: #2c3e50;
      }

      select,
      button {
        width: 100%;
        padding: 12px;
        border: 2px solid #bdc3c7;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        transition: all 0.3s ease;
      }

      select:focus,
      button:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .submit-btn {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        border: none;
        font-weight: bold;
        cursor: pointer;
        padding: 15px;
        font-size: 18px;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3);
      }

      .submit-btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .result {
        margin-top: 20px;
        padding: 20px;
        border-radius: 10px;
        display: none;
      }

      .result.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .result.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .file-info {
        background: #e8f4fc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìö Transliteration Tools</h1>
        <p>Convert and process your documents with advanced transliteration</p>
      </div>

      <div class="upload-area">
        <div class="file-input-wrapper">
          <div class="file-input" id="dropZone">
            <h3>üìÅ Drag & Drop your file here</h3>
            <p>or click to select a file</p>
            <p><small>Supported formats: EPUB, SRT, ZIP, TXT, MD, CSV</small></p>
            <input
              type="file"
              id="fileInput"
              style="display: none"
              accept=".epub,.srt,.zip,.txt,.md,.csv"
            />
          </div>
        </div>

        <div class="file-info" id="fileInfo">
          <strong>Selected file:</strong> <span id="fileName"></span>
          <br />
          <strong>File type:</strong> <span id="fileType"></span>
        </div>

        <div class="options-grid">
          <div class="option-group">
            <h3>üìñ Operation Type</h3>
            <select id="operationSelect">
              <option value="">Select operation based on file type</option>
            </select>
          </div>

          <div class="option-group">
            <h3>üåç Transliteration Type</h3>
            <select id="transliterationSelect">
              <option value="common">Common</option>
              <option value="cjk">CJK (Chinese, Japanese, Korean)</option>
              <option value="weird_cjk">Weird CJK</option>
              <option value="hindi">Hindi</option>
              <option value="japanese">Japanese</option>
              <option value="russian">Russian</option>
              <option value="arabic">Arabic</option>
            </select>
          </div>
        </div>

        <button class="submit-btn" id="submitBtn" disabled>Process File</button>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Processing your file... This may take a few moments.</p>
        </div>

        <div class="result" id="result"></div>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById('fileInput');
      const dropZone = document.getElementById('dropZone');
      const fileInfo = document.getElementById('fileInfo');
      const fileName = document.getElementById('fileName');
      const fileType = document.getElementById('fileType');
      const operationSelect = document.getElementById('operationSelect');
      const transliterationSelect = document.getElementById('transliterationSelect');
      const submitBtn = document.getElementById('submitBtn');
      const loading = document.getElementById('loading');
      const result = document.getElementById('result');

      let currentFile = null;

      // Drag and drop functionality
      dropZone.addEventListener('click', () => fileInput.click());

      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileSelect(files[0]);
        }
      });

      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileSelect(e.target.files[0]);
        }
      });

      function handleFileSelect(file) {
        const fileExt = file.name.split('.').pop().toLowerCase();
        const allowedExts = ['epub', 'srt', 'zip', 'txt', 'md', 'csv'];

        if (!allowedExts.includes(fileExt)) {
          alert('Please select a valid file type: EPUB, SRT, ZIP, TXT, MD, CSV');
          return;
        }

        currentFile = file;
        fileName.textContent = file.name;
        fileType.textContent = fileExt.toUpperCase();
        fileInfo.style.display = 'block';

        updateOperationOptions(fileExt);
        submitBtn.disabled = false;
      }

      function updateOperationOptions(fileExt) {
        operationSelect.innerHTML = '<option value="">Select operation</option>';

        const operations = {
          epub: [
            { value: 'split', text: 'Split EPUB sentences' },
            { value: 'transliteration', text: 'Transliteration' },
          ],
          srt: [
            { value: 'create_ebook', text: 'Create Ebook' },
            { value: 'transliteration', text: 'Text Transliteration' },
          ],
          zip: [
            { value: 'create_ebook', text: 'Create Ebook' },
            { value: 'transliteration', text: 'Text Transliteration' },
          ],
          txt: [
            { value: 'create_ebook', text: 'Create Ebook' },
            { value: 'transliteration', text: 'Text Transliteration' },
          ],
          md: [
            { value: 'create_ebook', text: 'Create Ebook' },
            { value: 'transliteration', text: 'Text Transliteration' },
          ],
          csv: [
            { value: 'create_ebook', text: 'Create Ebook' },
            { value: 'transliteration', text: 'Text Transliteration' },
          ],
        };

        const fileOps = operations[fileExt] || [];
        fileOps.forEach((op) => {
          const option = document.createElement('option');
          option.value = op.value;
          option.textContent = op.text;
          operationSelect.appendChild(option);
        });
      }

      submitBtn.addEventListener('click', async () => {
        if (!currentFile || !operationSelect.value) {
          alert('Please select a file and operation');
          return;
        }

        const formData = new FormData();
        formData.append('file', currentFile);
        formData.append('operation', operationSelect.value);
        formData.append('transliteration_type', transliterationSelect.value);

        loading.style.display = 'block';
        submitBtn.disabled = true;
        result.style.display = 'none';

        try {
          const response = await fetch('/upload', {
            method: 'POST',
            body: formData,
          });

          const data = await response.json();

          result.style.display = 'block';
          if (response.ok) {
            result.className = 'result success';
            result.innerHTML = `
                        <h4>‚úÖ ${data.message}</h4>
                        ${data.file ? `<p>Output file: ${data.file}</p>` : ''}
                        ${
                          data.file
                            ? `<a href="/download/${encodeURIComponent(
                                data.file
                              )}" download class="download-btn">Download Result</a>`
                            : ''
                        }
                    `;
          } else {
            result.className = 'result error';
            result.innerHTML = `<h4>‚ùå Error</h4><p>${data.error}</p>`;
          }
        } catch (error) {
          result.style.display = 'block';
          result.className = 'result error';
          result.innerHTML = `<h4>‚ùå Network Error</h4><p>${error.message}</p>`;
        } finally {
          loading.style.display = 'none';
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
